version: "3.9"

services:
  modula:
    container_name: modula_files_stack
    build:
      context: ..
      dockerfile: build/Dockerfile
    env_file:
      - .env
    restart: always

    ports:
      - "8081:8080"

    volumes:
      - /Users/juan-rodriguez/modula-edocs-transfer/.local/gcp-bucket:/gcp-bucket
      - ../api:/app/api

    networks:
      modula_shared_net:
        ipv4_address: 172.30.0.30

    mem_limit: 512m
    mem_reservation: 512m
    cpus: "0.5"

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/healthz"]
      interval: 20s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  modula_shared_net:
    driver: bridge
    external: true

volumes:
  gcp-bucket-dev:
    driver: local
  modula-stage:
    driver: local